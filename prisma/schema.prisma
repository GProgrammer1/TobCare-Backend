// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum GENDER {
  M
  F

  @@map("GENDER")
}

enum BLOODTYPE {
  A_pos  @map("A+")
  A_neg  @map("A-")
  B_pos  @map("B+")
  B_neg  @map("B-")
  O_pos  @map("O+")
  O_neg  @map("O-")
  AB_pos @map("AB+")
  AB_neg @map("AB-")

  @@map("BLOODTYPE")
}

model UserRole {
  id   Int    @id @default(autoincrement())
  role String @unique @db.VarChar(20)

  users User[]

  @@map("user_roles")
}

model User {
  id           BigInt   @id @default(autoincrement())
  username     String   @unique @db.VarChar(50)
  firstName    String   @map("first_name")
  lastName     String   @map("last_name")
  email        String   @unique @db.VarChar(30)
  passwordHash String   @map("password_hash")
  phoneNumber  String   @unique @map("phone_number")
  countryId    BigInt   @map("country_id")
  createdAt    DateTime @default(now()) @map("created_at")
  lastLoginAt  DateTime @default(now()) @map("last_login_at")
  roleId       Int      @map("role_id")

  role          UserRole             @relation(fields: [roleId], references: [id])
  country       Country              @relation(fields: [countryId], references: [id])
  patient       Patient?
  refreshTokens RefreshToken[]
  resetTokens   PasswordResetToken[]

  @@map("users")
}

model PasswordResetToken {
  id          BigInt   @id @default(autoincrement())
  hashedToken String   @unique @map("hashed_token")
  userId      BigInt   @map("user_id")
  expiresAt   DateTime @map("expires_at")
  createdAt   DateTime @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("password_reset_tokens")
}

model RefreshToken {
  id        BigInt    @id @default(autoincrement())
  token     String    @unique
  userId    BigInt    @map("user_id")
  expiresAt DateTime  @map("expires_at")
  createdAt DateTime  @default(now()) @map("created_at")
  revokedAt DateTime? @map("revoked_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("refresh_tokens")
}

model Country {
  id                BigInt @id @default(autoincrement())
  name              String @db.VarChar(50)
  phoneCode         String @map("phone_code") @db.VarChar(5)
  phoneNumberLength Int    @map("phone_number_length")

  users User[]

  @@map("countries")
}

model Patient {
  id          BigInt    @id @default(autoincrement())
  userId      BigInt    @unique @map("user_id")
  dateOfBirth String    @map("date_of_birth")
  gender      GENDER
  bloodType   BLOODTYPE @map("blood_type")
  address     String

  user User @relation(fields: [userId], references: [id])

  @@map("patients")
}
